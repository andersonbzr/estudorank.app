{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adsli/EstudoRank-patched-2025-10-22/estudorank/src/lib/supabase/client.ts"],"sourcesContent":["// src/lib/supabase/client.ts\r\nimport { createClient, type SupabaseClient } from \"@supabase/supabase-js\";\r\n\r\nlet _client: SupabaseClient | null = null;\r\n\r\n/**\r\n * Cliente do Supabase para uso no browser (componentes client).\r\n * Usa storageKey custom \"sr-auth\" para evitar conflitos e manter sessão.\r\n */\r\nexport function supabaseBrowser(): SupabaseClient {\r\n  if (_client) return _client;\r\n\r\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\n  const anon = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\r\n\r\n  if (!url || !anon) {\r\n    throw new Error(\r\n      \"Env vars ausentes: defina NEXT_PUBLIC_SUPABASE_URL e NEXT_PUBLIC_SUPABASE_ANON_KEY.\"\r\n    );\r\n  }\r\n\r\n  _client = createClient(url, anon, {\r\n    auth: {\r\n      persistSession: true,\r\n      autoRefreshToken: true,\r\n      storageKey: \"sr-auth\",\r\n    },\r\n  });\r\n\r\n  return _client;\r\n}\r\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;;AAYf;AAXd;;AAEA,IAAI,UAAiC;AAM9B,SAAS;IACd,IAAI,SAAS,OAAO;IAEpB,MAAM;IACN,MAAM;IAEN;;IAMA,UAAU,IAAA,0MAAY,EAAC,KAAK,MAAM;QAChC,MAAM;YACJ,gBAAgB;YAChB,kBAAkB;YAClB,YAAY;QACd;IACF;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adsli/EstudoRank-patched-2025-10-22/estudorank/src/app/reset-password/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { supabaseBrowser } from \"@/lib/supabase/client\";\r\n\r\n/**\r\n * /reset-password\r\n * - Troca o code/token do link por sessão\r\n * - Exibe formulário para definir a nova senha\r\n * - Redireciona para /me no sucesso\r\n */\r\nexport default function ResetPasswordPage() {\r\n  const [stage, setStage] = useState<\"checking\" | \"ready\" | \"error\">(\"checking\");\r\n  const [err, setErr] = useState<string | null>(null);\r\n  const [pwd, setPwd] = useState(\"\");\r\n  const [pwd2, setPwd2] = useState(\"\");\r\n  const router = useRouter();\r\n  const search = useSearchParams();\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const supabase = supabaseBrowser();\r\n\r\n        // 1) Novo formato (GoTrue v2): ?code=...\r\n        const code = search.get(\"code\");\r\n        if (code) {\r\n          const { error } = await supabase.auth.exchangeCodeForSession(code);\r\n          if (!error) { setStage(\"ready\"); return; }\r\n        }\r\n\r\n        // 2) Antigo: ?token_hash=...&type=recovery\r\n        const token_hash = search.get(\"token_hash\");\r\n        const type = search.get(\"type\");\r\n        if (token_hash && type === \"recovery\") {\r\n          const { error } = await supabase.auth.verifyOtp({ token_hash, type: \"recovery\" });\r\n          if (!error) { setStage(\"ready\"); return; }\r\n        }\r\n\r\n        // 3) Fallback: já logou automaticamente?\r\n        const { data } = await supabase.auth.getSession();\r\n        if (data.session) { setStage(\"ready\"); return; }\r\n\r\n        setErr(\"Link inválido ou expirado. Solicite um novo.\");\r\n        setStage(\"error\");\r\n      } catch {\r\n        setErr(\"Falha ao validar o link. Tente novamente.\");\r\n        setStage(\"error\");\r\n      }\r\n    })();\r\n  }, [search]);\r\n\r\n  async function submitNewPassword() {\r\n    if (!pwd || pwd.length < 8 || pwd !== pwd2) return;\r\n    const supabase = supabaseBrowser();\r\n    const { error } = await supabase.auth.updateUser({ password: pwd });\r\n    if (error) { setErr(error.message); return; }\r\n    router.replace(\"/me\");\r\n  }\r\n\r\n  if (stage === \"checking\") {\r\n    return <div className=\"min-h-[50vh] flex items-center justify-center\">Validando link...</div>;\r\n  }\r\n\r\n  if (stage === \"error\") {\r\n    return (\r\n      <div className=\"max-w-md mx-auto p-6\">\r\n        <h1 className=\"text-xl font-semibold mb-2\">Redefinir senha</h1>\r\n        <p className=\"text-sm text-rose-300 mb-4\">{err}</p>\r\n        <p className=\"text-sm opacity-70\">Volte ao login e use “Esqueci minha senha” para gerar um novo link.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // stage === \"ready\"\r\n  return (\r\n    <div className=\"max-w-md mx-auto p-6 space-y-4\">\r\n      <h1 className=\"text-xl font-semibold\">Definir nova senha</h1>\r\n\r\n      <input\r\n        type=\"password\"\r\n        placeholder=\"Nova senha (mín. 8)\"\r\n        className=\"input w-full rounded-xl bg-zinc-900 border border-zinc-800 px-3 py-2 outline-none focus:border-zinc-600\"\r\n        value={pwd}\r\n        onChange={(e) => setPwd(e.target.value)}\r\n      />\r\n      <input\r\n        type=\"password\"\r\n        placeholder=\"Confirmar senha\"\r\n        className=\"input w-full rounded-xl bg-zinc-900 border border-zinc-800 px-3 py-2 outline-none focus:border-zinc-600\"\r\n        value={pwd2}\r\n        onChange={(e) => setPwd2(e.target.value)}\r\n      />\r\n\r\n      <button\r\n        className=\"btn w-full h-11 rounded-xl font-medium bg-gradient-to-r from-emerald-500 to-indigo-500 text-white hover:opacity-90 disabled:bg-zinc-800 disabled:text-zinc-500\"\r\n        onClick={submitNewPassword}\r\n        disabled={!pwd || pwd.length < 8 || pwd !== pwd2}\r\n      >\r\n        Salvar nova senha\r\n      </button>\r\n\r\n      <p className=\"text-xs opacity-60\">Use 8+ caracteres, misture letras, números e símbolos.</p>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAYe,SAAS;;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAiC;IACnE,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,yKAAQ,EAAgB;IAC9C,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,yKAAQ,EAAC;IAC/B,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,SAAS,IAAA,wJAAe;IAE9B,IAAA,0KAAS;uCAAC;YACR;+CAAC;oBACC,IAAI;wBACF,MAAM,WAAW,AAFrB,IAEqB,sJAAe,AA2BnC;wBAzBG,yCAAyC;wBACzC,MAAM,OAAO,OAAO,GAAG,CAAC;wBACxB,IAAI,MAAM;4BACR,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,sBAAsB,CAAC;4BAC7D,IAAI,CAAC,OAAO;gCAAE,SAAS;gCAAU;4BAAQ;wBAC3C;wBAEA,2CAA2C;wBAC3C,MAAM,aAAa,OAAO,GAAG,CAAC;wBAC9B,MAAM,OAAO,OAAO,GAAG,CAAC;wBACxB,IAAI,cAAc,SAAS,YAAY;4BACrC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,SAAS,CAAC;gCAAE;gCAAY,MAAM;4BAAW;4BAC/E,IAAI,CAAC,OAAO;gCAAE,SAAS;gCAAU;4BAAQ;wBAC3C;wBAEA,yCAAyC;wBACzC,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;wBAC/C,IAAI,KAAK,OAAO,EAAE;4BAAE,SAAS;4BAAU;wBAAQ;wBAE/C,OAAO;wBACP,SAAS;oBACX,EAAE,UAAM;wBACN,OAAO;wBACP,SAAS;oBACX;gBACF;;QACF;sCAAG;QAAC;KAAO;IAEX,eAAe;QACb,IAAI,CAAC,OAAO,IAAI,MAAM,GAAG,KAAK,QAAQ,MAAM;QAC5C,MAAM,WAAW,IAAA,sJAAe;QAChC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU,CAAC;YAAE,UAAU;QAAI;QACjE,IAAI,OAAO;YAAE,OAAO,MAAM,OAAO;YAAG;QAAQ;QAC5C,OAAO,OAAO,CAAC;IACjB;IAEA,IAAI,UAAU,YAAY;QACxB,qBAAO,6LAAC;YAAI,WAAU;sBAAgD;;;;;;IACxE;IAEA,IAAI,UAAU,SAAS;QACrB,qBACE,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAG,WAAU;8BAA6B;;;;;;8BAC3C,6LAAC;oBAAE,WAAU;8BAA8B;;;;;;8BAC3C,6LAAC;oBAAE,WAAU;8BAAqB;;;;;;;;;;;;IAGxC;IAEA,oBAAoB;IACpB,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,WAAU;0BAAwB;;;;;;0BAEtC,6LAAC;gBACC,MAAK;gBACL,aAAY;gBACZ,WAAU;gBACV,OAAO;gBACP,UAAU,CAAC,IAAM,OAAO,EAAE,MAAM,CAAC,KAAK;;;;;;0BAExC,6LAAC;gBACC,MAAK;gBACL,aAAY;gBACZ,WAAU;gBACV,OAAO;gBACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;;;;;;0BAGzC,6LAAC;gBACC,WAAU;gBACV,SAAS;gBACT,UAAU,CAAC,OAAO,IAAI,MAAM,GAAG,KAAK,QAAQ;0BAC7C;;;;;;0BAID,6LAAC;gBAAE,WAAU;0BAAqB;;;;;;;;;;;;AAGxC;GA9FwB;;QAKP,kJAAS;QACT,wJAAe;;;KANR","debugId":null}}]
}